<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>vert.x - Sogeti Guru Night</title>

    <meta name="description" content="Workshop vert.x and micro-services">
    <meta name="author" content="Clement Escoffier">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="lib/css/bootstrap.css" id="theme">
    <link rel="stylesheet" href="css/theme/vertx.css">

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
</head>

<body>

<div class="reveal">

    <!-- Any section element inside of this container is displayed as a slide -->
    <div class="slides">
        <section>
            <div class="container-fluid">
                <div class="row  vertical-align">
                    <div class="col-md-2">
                        <img src="css/theme/img/logo.png" style="width: 60%;
                        box-shadow: none;
                        border: none"/>
                    </div>
                    <div class="col-md-10">
                        <div>
                            <h1>Vert<span style="letter-spacing: 6px;" class="purple">.X</span></h1>

                            <h3>Sogeti Guru Night</h3>

                            <p>
                                <small>Paulo Lopes</small>
                            </p>
                        </div>
                    </div>
                </div>
                <footer class="title-footer">#sogeti #gurunight
                    <span class="pull-right">plopes@redhat.com</span></footer>
            </div>
        </section>

        <section>
            <h1>Welcome</h1>

            <h3 class="hand">Did you already use vert.x ?</h3>

            <h3 class="hand">Did you hear about micro-services architecture ?</h3>

            <h3 class="hand">Did you already deployed micro-services based applications ?</h3>
        </section>

        <section>
            <h1>Outline</h1>

            <ul style="list-style-image: none">
                <li>Micro-services: why and what</li>
                <li>vert.x in 30 minutes</li>
                <li>Presentation of the application: <em>Vert2go</em></li>
                <li>You first service</li>
                <li>Composing vert.x service</li>
                <li>Consuming a REST api</li>
                <li>Providing a REST api</li>
                <li>Deploying some parts on the Cloud</li>
                <li>Monitoring</li>
            </ul>

            <aside class="notes">
                This is intended to be modified dynamically...
            </aside>
        </section>

        <section>
            <h1>Some technologies</h1>

            <p>vert.x</p>

            <p>docker</p>

            <p>openshift</p>

            <p>hawkular</p>

            <p>grafana</p>
        </section>

        <section>
            <h1>Micro-services: why and what</h1>
        </section>

        <section>
            <h1>
                <span style="font-size: medium">Because it</span>
                <span style="font-size: large">grows</span>
                <span style="font-size: x-large">faster</span>
                <span style="font-size: xx-large">than you</span>
                <span style="font-size: larger">think</span></h1>
            <img src="img/micro-services/expansion.png" style="width:100%">
        </section>

        <section>
            <h1>Becoming touchy</h1>
            <img src="img/micro-services/jenga.png">
        </section>

        <section>
            <h2>Decentralization</h2>

            <p>To keep things under control, makes them:</p>
            <p>small</p>
            <p>loosely-coupled</p>
            <p>highly coherent</p>
        </section>

        <section>
            <h1>Process</h1>

            <img src="img/micro-services/extraction.png" width="500">
        </section>

        <section>
            <h1>Process</h1>

            <img src="img/micro-services/micro-service-1.png" width="500">
        </section>

        <section>
            <h1>Process</h1>

            <img src="img/micro-services/extraction-2.png" width="500">
        </section>

        <section>
            <h1>Process</h1>

            <img src="img/micro-services/micro-service-2.png" width="500">
        </section>

        <section>
            <h2>A few steps later</h2>

            <img src="img/micro-services/micro-service-3.png" width="600">
        </section>

        <section>
            <h2>Not a silver bullet</h2>

            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-5">

                        <h3 class="purple column-header">Pro</h3>

                        <h5 class="hand">Asynchronous evolution</h5>
                        <h5 class="hand">Better local understanding</h5>
                        <h5 class="hand">Scalability</h5>
                        <h5 class="hand">Integration / Polyglot</h5>
                    </div>
                    <div class="col-md-1">
                        &nbsp;
                    </div>
                    <div class="col-md-5 fragment">
                        <h3 class="purple column-header">Cons</h3>
                        <h5 class="hand">Global debug</h5>
                        <h5 class="hand">Deployment</h5>
                        <h5 class="hand">Latency (multi-hop)</h5>
                        <h5 class="hand">Dynamic availability</h5>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h1 class="hand">Micro-service</h1>
            <h1 style="color: #d50000" class="hand">!=</h1>
            <h1 class="hand">container</h1>
        </section>

        <section>
            <h1 class="hand">Micro-service</h1>
            <h1 style="color: #d50000" class="hand">!=</h1>
            <h1 class="hand">REST</h1>
        </section>

        <section>
            <h1>Vert<span style="letter-spacing: 6px;" class="purple">.X</span></h1>

            <h3 class="hand">a toolkit to build micro-service applications</h3>

        </section>

        <section>
            <h1>Vert<span style="letter-spacing: 6px;" class="purple">.X</span></h1>

            <h3 class="hand fragment">Framework</h3>

            <h3 class="hand fragment">Unopiniated</h3>

            <h3 class="hand fragment">Reactive</h3>

            <h3 class="hand fragment">Polyglot</h3>

            <h3 class="hand fragment">Distributed</h3>

        </section>

        <section>
            <h2>Reactor-pattern</h2>

            <img src="img/vertx/reactor-pattern.png"/>

        </section>

        <section>
            <h2>Reactor-pattern</h2>

            <img src="img/vertx/reactor-pattern-blocking.png"/>

        </section>

        <section>
            <h2>Reactor-pattern</h2>

            <img src="img/vertx/reactor-event-loop.png"/>

        </section>

        <section>
            <h2>Reactor-pattern</h2>

            <img src="img/vertx/reactor-event-loop-many-events.png"/>

        </section>

        <section>
            <h2>What is <img src="img/vertx/event-dark-blue.png"
                             style="display: inline-table; vertical-align: bottom;"/> ?
            </h2>
            <h4 class="hand">A Message</h4>
            <h4 class="hand">A Notification</h4>
            <h4 class="hand">A HTTP Request</h4>
            <h4 class="hand">A command</h4>
            <h4 class="hand">A file</h4>
            <h4 class="hand">A result, an error</h4>
        </section>

        <section>
            <h2>Asynchronous Development Model</h2>
            <pre><code class="hljs">void operation(param1, param2, Handler&lt;T&gt; handler) {
  // ...
  T t = ...
  handler.handle(t)
  // ...
}</code></pre>
            <pre class="fragment"><code class="hljs">void handle(T t) {
  // do something with t
}</code></pre>
            <pre class="fragment"><code class="hljs">operation(1, 2, t -> System.out.println(t));</code></pre>

        </section>

        <section>
            <h2>Asynchronous Development Model</h2>
            <img src="img/vertx/http-example.png">
        </section>

        <section>
            <h2>The event bus</h2>

            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-6">
                        <img src="img/vertx/event-bus-ptp.png"/>
                    </div>
                    <div class="col-md-6">
                        <div class="frame">
                            <div class="frame-inner">
                                <h4 class="hand">Point to Point</h4>
                                <h4 class="hand">Publish / Subscribe</h4>
                                <h4 class="hand">Request / Response</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h2>The event bus</h2>

            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-6">
                        <img src="img/vertx/event-bus-ps.png"/>
                    </div>
                    <div class="col-md-6">
                        <div class="frame">
                            <div class="frame-inner">
                                <h4 class="hand">Point to Point</h4>
                                <h4 class="hand">Publish / Subscribe</h4>
                                <h4 class="hand">Request / Response</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h2>The event bus</h2>

            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-6">
                        <img src="img/vertx/event-bus-rr.png"/>
                    </div>
                    <div class="col-md-6">
                        <div class="frame">
                            <div class="frame-inner">
                                <h4 class="hand">Point to Point</h4>
                                <h4 class="hand">Publish / Subscribe</h4>
                                <h4 class="hand">Request / Response</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h2>The event bus</h2>

            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-7">
                        <img src="img/vertx/event-bus-distributed.png"/>
                    </div>

                    <div class="col-md-5">
                        <div class="frame">
                            <div class="frame-inner">
                                <h4 class="hand">The event bus allows
                                    distributed communication.
                                </h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h2>The event bus</h2>

            <div class="row">
                <div class="col-md-6">
                    <img src="img/vertx/event-bus-bridge.png"/>
                </div>
                <div class="col-md-1">
                    &nbsp;
                </div>
                <div class="col-md-5">
                    <div class="frame" style="padding: 50px">
                        <div class="frame-inner">
                            <h4 class="hand">Almost anything <br/>can send / receive messages
                            </h4>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h2>Verticles <br/> An agent-like model</h2>

            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-6">
                        <img src="img/vertx/verticle.png"/>
                    </div>
                    <div class="col-md-1">
                        &nbsp;
                    </div>
                    <div class="col-md-5">
                        <div class="frame" style="padding: 50px">
                            <div class="frame-inner">
                                <h4 class="hand">Verticles are chunks of code that get deployed and run by Vert.x.</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <pre><code class="hljs java">vertx.deployVerticle("my.verticle");</code></pre>
        </section>

        <section>
            <h2>Verticles <br/> An agent-like model</h2>
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-8">
                        <img src="img/vertx/verticle-fail-over.png"/>
                    </div>

                    <div class="col-md-4">
                        <div class="frame" style="padding: 35px">
                            <div class="frame-inner">
                                <h4 class="hand" >
                                    Dead verticles are restarted on a running node.
                                </h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <pre><code class="hljs java">vertx.deployVerticle("my.verticle"),
                new DeploymentOptions().setHA(true));</code></pre>
        </section>

        <section data-background="img/vertx/eventbus-alone.png" data-background-size="500px">
            <h2>Polyglot</h2>
            <br/>
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-5">
                        <pre><code class="hljs java">EventBus eb =
vertx.eventBus();
eb.publish("some-topic",
  "Some data from Java");</code></pre>
                    </div>
                    <div class="col-md-2">
                        &nbsp;
                    </div>
                    <div class="col-md-5">
                        <pre><code class="hljs javascript">var eb = vertx.eventBus();
eb.publish("some-topic",
  "Some data from JS");</code></pre>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-5">
                        <pre><code class="hljs ruby">eb = $vertx.event_bus()
eb.publish("some-topic",
  "Some data from Ruby")</code></pre>
                    </div>
                    <div class="col-md-2">
                        &nbsp;
                    </div>
                    <div class="col-md-5">
                        <pre><code class="hljs groovy">def eb = vertx.eventBus()
eb.publish("some-topic",
  "Some data from Groovy")</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h2>vert.x in 1 slide</h2>
            <img src="img/vertx/vertx-1-slide.png"/>
        </section>

        <section>
            <h1>Vert<span style="letter-spacing: 6px;" class="purple">.X</span><br/>&amp;<br/>Micro-Services</h1>
        </section>

        <section>
            <img src="img/vertx/stack.png"/>
        </section>

        <section>
            <h2>From verticles to micro-services</h2>

            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-6">
                        <img src="img/vertx/verticles-interaction.png"/>
                    </div>
                    <div class="col-md-1">
                        &nbsp;
                    </div>
                    <div class="col-md-5">
                        <div class="frame" style="padding: 50px">
                            <div class="frame-inner">
                                <h4 class="hand">Verticles are loosely-coupled.</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h2>From verticles to micro-services</h2>

            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-7">
                        <img src="img/vertx/verticles-fat-jar.png"/>
                    </div>
                    <div class="col-md-5">
                        <div class="frame" style="padding: 50px">
                            <div class="frame-inner">
                                <h4 class="hand">Verticles can be deployed individually.</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h2>From verticles to micro-services</h2>

            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-7">
                        <img src="img/vertx/verticles-fat-jar.png"/>
                    </div>
                    <div class="col-md-5">
                        <div class="frame" style="padding: 50px">
                            <div class="frame-inner">
                                <h4 class="hand">Verticles can <br/>evolve<br/> asynchronously.</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h2>From verticles to micro-services</h2>

            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-7">
                        <img src="img/vertx/verticles-fat-jar.png"/>
                    </div>
                    <div class="col-md-5">
                        <div class="frame" style="padding: 50px">
                            <div class="frame-inner">
                                <h4 class="hand">Micro-services interacts using the event bus.</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h2>From verticles to micro-services</h2>

            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-8">
                        <img src="img/vertx/micro-services.png"/>
                    </div>
                    <div class="col-md-4">
                        <div class="frame" style="padding: 40px">
                            <div class="frame-inner">
                                <h4 class="hand">... or using HTTP, TCP<br/>
                                    STOMP, AMQP...</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h2>Service Proxies</h2>

            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-8">
                        <img src="img/vertx/service-proxies.png"/>
                    </div>
                    <div class="col-md-4">
                        <div class="frame" style="padding: 40px">
                            <div class="frame-inner">
                                <h4 class="hand">Generated proxies for the event bus.</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h2>Service Proxies</h2>

            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-7">
                        <img src="img/vertx/js-service-proxies.png"/>
                    </div>
                    <div class="col-md-5">
                        <div class="frame" style="padding: 50px">
                            <div class="frame-inner">
                                <h4 class="hand">Consumption of services from node.js or the browser.</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h1>vert<span class="purple">2</span>go</h1>
        </section>

        <section>
            <h2>vert<span class="purple">2</span>go</h2>
            <p>Micro-Service application</p>
            <p>Storage: MongoDB, Redis</p>
            <p>Service invocation protocol: Event Bus proxies, REST</p>
            <p>UI: Angular, SockJS</p>
        </section>

        <section>
            <h2>Architecture</h2>
            <img src="img/application/architecture.png" width="800"/>
        </section>

        <section>
            <h2>Deployment</h2>
            <img src="img/application/deployment.png" width="800"/>
        </section>

        <section>
            <h2>Prerequisites</h2>
            <p>Git</p>
            <p>Maven</p>
            <p>Docker</p>
            <p>Optionally: an Openshift account</p>

            <p>Windows user: Virtualbox</p>
            <p>Mac OS X user: docker-machine</p>
        </section>

        <section>
            <h1>Step 0</h1>
            <p class="main-instruction">Scaffolding</p>
            <pre><code>git clone https://github.com/pmlopes/sogeti-gurunight-2015.git
sogeti-gurunight-2015
mvn clean install</code></pre>
        </section>

        <section>
            <h1>Step 0</h1>
            <p>Linux: use <code>conf/config.json</code></p>
            <p>Mac: use <code>conf/config-docker-machine.json</code></p>
        </section>


        <section>
            <h1>Step 1</h1>
            <p class="main-instruction">Start mongoDB</p>
            <pre><code>docker run --name some-mongo -d -p 27017:27017 mongo</code></pre>
            <em>(no persistent storage)</em>
        </section>

        <section>
            <h1>Step 2</h1>
            <p class="main-instruction">Data Storage Service</p>
            <p>Define the <code>place</code> structure</p>
            <p>Interact with MongoDB</p>
            <p>Expose a service on the Event Bus</p>
        </section>

        <section>
            <h1>Step 2</h1>
            <p class="main-instruction">Data Storage Service</p>
            <pre><code>cd data-storage-service
mvn clean install</code></pre>
        </section>

        <section>
            <h1>Step 2</h1>
            <p class="main-instruction">The place structure</p>
            <pre><code>/**
* The place structure.
*
* It's a data object that can be serialized to JSON (and built from
* JSON). Data objects can be used in event bus proxies.
*/
@DataObject(generateConverter = true)
public class Place {
  // ...
}
            </code></pre>
        </section>

        <section>
            <h1>Step 2</h1>
            <p class="main-instruction">The place structure</p>
            <pre class="java"><code>public Place() { /* Empty constructor */ }

public Place(Place other) {
  this.name = other.name;
  //...
}

public Place(JsonObject json) {
  PlaceConverter.fromJson(json, this);
}

public JsonObject toJson() {
  JsonObject json = new JsonObject();
  PlaceConverter.toJson(this, json);
  return json;
}</code></pre>
        </section>

        <section>
            <h1>Step 2</h1>
            <p class="main-instruction">The place structure</p>
            <p>Just getters and setters on the fields</p>
            <p>It's jackson under the hood</p>
        </section>

        <section>
            <h1>Step 2</h1>
            <p class="main-instruction">The data storage service</p>
            <pre><code>/**
 * Service exposed on the event bus to provide access to
 * the stored Places.
 */
@VertxGen
@ProxyGen
public interface DataStorageService {

  static DataStorageService createProxy(Vertx vertx, String address) {
    return ProxyHelper
      .createProxy(DataStorageService.class, vertx, address);
  }

  void getAllPlaces(Handler&lt;AsyncResult&lt;List&lt;Place>>> resultHandler);
  void addPlace(Place place, Handler&lt;AsyncResult&lt;Void>> resultHandler);
}</code></pre>

        </section>

        <section>
            <h1>Step 2</h1>
            <p class="main-instruction">The data storage service</p>
            <p>Open the <code>i.v.d.d.i.DataStorageServiceImpl</code> class</p>
            <pre class="java"><code>public void getPlacesForCategory(String category,
  Handler&lt;AsyncResult&lt;List&lt;Place>>> resultHandler) {
    mongo.find(COLLECTION,
      new JsonObject().put("category", category),
      ar -> {
        if (ar.failed()) {
          resultHandler.handle(Future.failedFuture(ar.cause()));
        } else {
          List&lt;Place> places = ar.result().stream()
                .map(Place::new).collect(Collectors.toList());
          resultHandler.handle(Future.succeededFuture(places));
        }
      }
    );
}</code></pre>
        </section>

        <section>
            <h1>Step 2</h1>
            <p class="main-instruction">The data storage service</p>
            <p>The verticle instantiating the service</p>
            <pre><code>private DataStorageServiceImpl service;

@Override
public void start() throws Exception {
  service = new DataStorageServiceImpl(vertx, config());
  ProxyHelper.registerService(DataStorageService.class, vertx, service,
    "vertx2go.places");
}

@Override
public void stop() throws Exception {
  service.close();
}</code></pre>
        </section>

        <section>
            <h1>Step 2</h1>
            <p class="main-instruction">Executing  data storage service</p>
            <p>It needs a configuration to connect to the mongo database (src/conf/config.json)</p>
            <pre><code>{
  "db_name" : "places",
  "connection_string": "mongodb://localhost:27017"
}</code></pre>
            <p>Update the mongo adress on mac to <code>192.168.99.100</code>.</p>
        </section>

        <section>
            <h1>Step 2</h1>
            <p class="main-instruction">Executing the data storage service</p>
            <p>The maven build has created an executable <em>fat</em> jar</p>
            <pre><code>
java -jar target/data-storage-service-1.0-SNAPSHOT-fat.jar \
  --cluster \
  --conf=src/conf/config.json
            </code></pre>
        </section>

        <section>
            <h1>Step 3</h1>
            <p class="main-instruction">Provisioning some data</p>
            <p>The data is extracted from http://mapme.com</p>
            <p>This data is consumed as JSON and inserted into the mongo database (without using the service)</p>
            <pre><code>cd data-provisioning
mvn clean package</code></pre>
        </section>

        <section>
            <h1>Step 3</h1>
            <p class="main-instruction">Provisioning some data</p>
            <p>Calling a HTTP service</p>
            <pre><code>private void provision() {
  HttpClient client = vertx.createHttpClient();
  client.getNow(80, "mapme.com",
    "/api/map/910f1efe-d403-481e-a87e-bd8c9df7a131/places",
    response -> {
       /* TODO */
    }
  );
}</code></pre>
        </section>

        <section>
            <h1>Step 3</h1>
            <p class="main-instruction">Executing the provisioner</p>
            <pre><code>mvn clean package
java -jar target/data-provisioning-1.0-SNAPSHOT-fat.jar \
  --conf src/conf/config.json
# when done, CTRL+C
</code></pre>
        </section>

        <section>
            <h1>Step 4</h1>
            <p class="main-instruction">A simple service client</p>
            <p>Just to be sure that everything works</p>
            <pre><code>cd data-storage-client
mvn clean package
java -jar target/data-storage-client-1.0-SNAPSHOT-fat.jar --cluster
# CTRL+C to exit
            </code></pre>
        </section>

        <section>
            <h1>Step 4</h1>
            <p class="main-instruction">A simple client in Groovy</p>
            <pre><code>def service = DataStorageService.createProxy(vertx, "vertx2go.places")
service.getAllPlaces({
  result ->
    // TODO
})</code></pre>
            <p>Under the hood, JSON messages are sent, process and returned.</p>
        </section>

        <section>
            <h1>Step 5</h1>
            <p class="main-instruction">The Map services</p>
            <ul>
                <li>These services provides map tiles.</li>
                <li>The map server service acts as a "proxy" on the Map Render Service.</li>
                <li>Both provide a REST API</li>
                <li>Let's deploy the Map Render Service in the Cloud</li>
            </ul>
        </section>

        <section>
            <h1>Step 5</h1>
            <p class="main-instruction">The Map Render Service</p>
            <ul>
                <li>It's a vert.x application packaged as a <em>fat jar</em>.</li>
                <li>We use the Openshift vert.x 3 cartridge</li>
                <pre><code>rhc create-app map0render0service
https://raw.githubusercontent.com/vert-x3/vertx-openshift-cartridge/master/metadata/manifest.yml
                </code></pre>
                <li>We copy the fat jar in <code>./application</code></li>
                <li>Git add, commit and push</li>
                <pre><code>git add -A
git commit -m "deploy my application"
git push origin master</code></pre>
            </ul>
        </section>

        <section>
            <h1>Step 5</h1>
            <p class="main-instruction">The Map Server Proxy - version service</p>
            <ul>
                <li>It's also a vert.x application packaged as a <em>fat jar</em>.</li>
            </ul>
            <pre><code>cd map-server-proxy
mvn clean package
java -jar target/map-server-proxy-1.0-SNAPSHOT-fat.jar start</code></pre>
            <ul>
                <li>No <code>-cluster</code> - we expose a REST API (not based on the event bus)</li>
                <li>We start this application in background (<code>start</code>)</li>
            </ul>
        </section>

        <section>
            <h1>Step 5</h1>
            <p class="main-instruction">The Map Server Proxy - version docker</p>
            <ul>
                <li>It's also a vert.x application packaged as a <em>fat jar</em>.</li>
                <li>Running in a docker container</li>
            </ul>
            <pre><code>cd map-server-proxy
mvn clean package docker:build
docker run -t -i -p 8000:8000 vertx-vertx2go/map-server-proxy
</code></pre>
        </section>

        <section>
            <h1>Step 6</h1>
            <p class="main-instruction">Deploying the frontend</p>
            <p>The frontend is developed in JavaScript (server and client)</p>
            <p>Edit src/main/resources/webroot/js/controllers.js and set the right addresses</p>
            <pre><code>cd ../frontend
mvn clean package
java -jar target/frontend-1.0-SNAPSHOT-fat.jar --cluster</code></pre>
            <p>http://localhost:8080/</p>
        </section>

        <section data-background="img/vert_x_-_vert2go.png">

        </section>

        <section data-background="img/app-anatomy.png">

        </section>

        <section>
            <h1>Step 5</h1>
            <p class="main-instruction">Deploying the frontend</p>
<pre><code>
Members [2] {
  Member [192.168.1.29]:5701      <--- Data Storage Service
  Member [192.168.1.29]:5702 this <--- Frontend
}</code></pre>
        </section>

        <section>
            <h1>Step 5</h1>
            <p class="main-instruction">some parts are missing ?</p>
            <pre><code>
Cannot read property 'up' of undefined
            </code></pre>
            <p>The recommendation service is missing</p>
        </section>

        <section>
            <h1>Step 6</h1>
            <p class="main-instruction">The recommendation service</p>
            <p>First, we need Redis:</p>
            <pre><code>docker run -d -p 6379:6379 redis</code></pre>
        </section>

        <section>
            <h1>Step 6</h1>
            <p class="main-instruction">The recommendation service</p>
            <p>Open the <code>RecommendationServiceImpl</code> class, and write the missing parts</p>
        </section>

        <section>
            <h1>Step 6</h1>
            <p class="main-instruction">The recommendation service</p>
            <pre><code>mvn clean package
java -jar target/recommendation-service-1.0-SNAPSHOT-fat.jar -cluster -conf src/conf/config.json</code></pre>
        </section>

        <section>
            <h1>Step 6</h1>
            <p class="main-instruction">Is it working ?</p>
            <p>go back to the application (browser), and try to vote</p>
        </section>

        <section>
            <h1>Step 7</h1>
            <p class="main-instruction">Monitoring</p>
            <p>Monitoring is key in micro-service applications:</p>
            <ul>
                <li>Logs</li>
                <li>Availability</li>
                <li>Technical metrics</li>
                <li>Business metrics</li>
            </ul>
            <p>It's important to centralized these data</p>
        </section>

        <section>
            <h1>Step 7</h1>
            <p class="main-instruction">Centralizing Logs</p>
            <p>You can use any log collector, we are going to use Graylog2</p>
            <pre><code>docker run -t -p 9000:9000 -p 12201:12201 -p 12201:12201/udp \
 graylog2/allinone</code></pre>
            <p>This image requires you to create the UDP / TCP sources</p>
        </section>

        <section>
            <h1>Step 7</h1>
            <p class="main-instruction">Configuring Graylog</p>
            <ul>
                <li>Open http://localhost:9000 and log in (admin/admin)</li>
                <li>Go to system - input</li>
                <li>Select <code>Gelf UDP</code> and click on <em>Launch new input</em></li>
                <li>Check the <em>Global input</em> checkbox</li>
                <li>Set a name</li>
                <li>Click on <em>Launch</em></li>
            </ul>
        </section>

        <section>
            <h1>Step 7</h1>
            <p class="main-instruction">Centralizing Logs</p>
            <p>In the data-storage-service, add some log using <code>LOGGER</code>.</p>
            <p>Configure the <em>handler</em> to emit the logged messages:</p>
                <ul>
                    <li>copy the logging configuration from ../etc to src/main/resource</li>
                    <li>remove the -graylog suffix</li>
                    <li>re-package and relaunch the data storage service</li>
                    <li>Check the sent messages</li>
                </ul>
        </section>
        <section>
            <h1>Step 7</h1>
            <p class="main-instruction">Centralizing Logs (JUL)</p>
            <pre><code>handlers=java.util.logging.ConsoleHandler,java.util.logging.FileHandler,biz.paluch.logging.gelf.jul.GelfLogHandler
#...
biz.paluch.logging.gelf.jul.GelfLogHandler.level=INFO

biz.paluch.logging.gelf.jul.GelfLogHandler.host=server-ip
biz.paluch.logging.gelf.jul.GelfLogHandler.port=12201
biz.paluch.logging.gelf.jul.GelfLogHandler.version=1.1</code></pre>
            <p><em>vertx-default-jul-logging.properties</em></p>
        </section>


        <section>
            <h1>Step 7</h1>
            <p class="main-instruction">Messages sent to Graylog</p>
            <img src="img/Graylog.png"/>
        </section>

        <section>
            <h1>Step 8</h1>
            <p class="main-instruction">Send monitored data to Hawkular</p>
            <ul>
                <li>Hawkular is a monitoring and management Platform</li>
                <li>Time series</li>
                <li>Send data using a REST API</li>
                <li>Expose a Grafana compliant database</li>
            </ul>
        </section>

        <section>
            <h1>Step 8</h1>
            <p class="main-instruction">Send monitored data to Hawkular</p>
            <ul>
                <li>Send data to the event bus</li>
                <li>A bridge send it to Hawkular</li>
                <li>Manage a dashboard on Grafana</li>
            </ul>
        </section>

        <section>
            <h1>Step 8</h1>
            <p class="main-instruction">Start Hawkular</p>
            <pre><code>docker run -t -i -p 8090:8080 jboss/hawkular-aio</code></pre>
        </section>

        <section>
            <h1>Step 8</h1>
            <p class="main-instruction">Start the Hawkular bridge</p>
            <pre><code>cd eventbus-to-hawkular-bridge
mvn clean package
java -jar target/eventbus-to-hawkular-bridge-1.0-SNAPSHOT-fat.jar \
  -conf src/conf/config.json -cluster
            </code></pre>
        </section>

        <section>
            <h1>Step 8</h1>
            <p class="main-instruction">Send data</p>
            <pre><code>private void report(long time) {
  vertx.eventBus().send("metrics", new JsonObject()
    .put("source", "mongo.query")
    .put("value", time));
}</code></pre>
        </section>

        <section>
            <h1>Step 8</h1>
            <p class="main-instruction">Launch grafana</p>
            <pre><code>docker run -i -p 3000:3000 grafana/grafana</code></pre>
        </section>

        <section>
            <h1>Step 8</h1>
            <p class="main-instruction">Create Hawkular datasource</p>
            <img src="img/grafana/datasource.png"/>
        </section>

        <section>
            <h1>Step 8</h1>
            <p class="main-instruction">Create and customise a dashboard</p>
            <img src="img/grafana/graph.png"/>
        </section>

        <section>
            <h1 class="hand">That's all folks!</h1>
        </section>

    </div> <!-- end of slides -->
</div> <!-- end of reveal -->

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>

    // Full list of configuration options available at:
    // https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        controls: false,
        progress: true,
        history: true,
        center: true,

        transition: 'slide', // none/fade/slide/convex/concave/zoom
        backgroundTransition: 'slide',

        // Optional reveal.js plugins
        dependencies: [
            { src: 'socket.io/socket.io.js', async: true },
            { src: 'plugin/notes-server/client.js', async: true },

            {
                src: 'lib/js/classList.js', condition: function () {
                return !document.body.classList;
            }
            },
            {
                src: 'plugin/markdown/marked.js', condition: function () {
                return !!document.querySelector('[data-markdown]');
            }
            },
            {
                src: 'plugin/markdown/markdown.js', condition: function () {
                return !!document.querySelector('[data-markdown]');
            }
            },
            {
                src: 'plugin/highlight/highlight.js', async: true, condition: function () {
                return !!document.querySelector('pre code');
            }, callback: function () {
                hljs.initHighlightingOnLoad();
            }
            },
            {src: 'plugin/zoom-js/zoom.js', async: true},
            {src: 'plugin/notes/notes.js', async: true}
        ]
    });

</script>

</body>
</html>
